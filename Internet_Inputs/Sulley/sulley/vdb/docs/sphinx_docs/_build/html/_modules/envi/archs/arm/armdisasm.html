

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>envi.archs.arm.armdisasm &mdash; Visi Debugger  documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="Visi Debugger  documentation" href="../../../../index.html" />
    <link rel="up" title="envi.archs.arm" href="../arm.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Visi Debugger  documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../../envi.html" >envi</a> &raquo;</li>
          <li><a href="../arm.html" accesskey="U">envi.archs.arm</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for envi.archs.arm.armdisasm</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="kn">import</span> <span class="nn">envi</span>
<span class="kn">import</span> <span class="nn">envi.bits</span> <span class="kn">as</span> <span class="nn">e_bits</span>
<span class="kn">from</span> <span class="nn">envi.bits</span> <span class="kn">import</span> <span class="n">binary</span>

<span class="kn">from</span> <span class="nn">envi.archs.arm.const</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">envi.archs.arm.regs</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># Universal opcode things:</span>
<span class="c"># len</span>
<span class="c"># mode</span>

<span class="c">#FIXME: TODO</span>
<span class="c">#   * Thumb Extension Parser</span>
<span class="c">#   * Jazelle Extension Parser</span>
<span class="c">#   * Emulators</span>

<span class="c">####################################################################</span>
<span class="c"># Parsers for the multiply family of instruction encodings</span>

<div class="viewcode-block" id="chopmul"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.chopmul">[docs]</a><span class="k">def</span> <span class="nf">chopmul</span><span class="p">(</span><span class="n">opcode</span><span class="p">):</span>
    <span class="n">op1</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&gt;&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span>  <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span>  <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">op1</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">d</span><span class="p">,(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>

<span class="c"># FIXME this seems to be universal...</span></div>
<div class="viewcode-block" id="addrToName"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.addrToName">[docs]</a><span class="k">def</span> <span class="nf">addrToName</span><span class="p">(</span><span class="n">mcanv</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">mcanv</span><span class="o">.</span><span class="n">syms</span><span class="o">.</span><span class="n">getSymByAddr</span><span class="p">(</span><span class="n">va</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sym</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;0x</span><span class="si">%.8x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">va</span>

<span class="c"># The keys in this table are made of the</span>
<span class="c"># concat of bits 27-21 and 7-4 (only when</span>
<span class="c"># ienc == mul!</span></div>
<span class="n">iencmul_codes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c"># Basic multiplication opcodes</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000000001001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;mul&quot;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000000011001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;mul&quot;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">IF_PSR_S</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000000101001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;mla&quot;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000000111001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;mla&quot;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">IF_PSR_S</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000001001001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;umaal&quot;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000010001001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;umull&quot;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000010011001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;umull&quot;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">IF_PSR_S</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000010101001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;umlal&quot;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000010111001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;umlal&quot;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">IF_PSR_S</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000011001001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smull&quot;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000011011001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smull&quot;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">IF_PSR_S</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000011101001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlal&quot;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000011111001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlal&quot;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">IF_PSR_S</span><span class="p">),</span>

    <span class="c"># multiplys with &lt;x&gt;&lt;y&gt;</span>
    <span class="c"># &quot;B&quot;</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000100001000&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlabb&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000100001010&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlatb&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000100001100&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlabt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000100001110&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlatt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000100101010&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smulwb&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000100101110&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smulwt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000100101000&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlawb&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000100101100&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlawt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000101001000&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlalbb&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000101001010&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlaltb&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000101001100&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlalbt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000101001110&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlaltt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000101101000&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smulbb&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000101101010&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smultb&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000101101100&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smulbt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;000101101110&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smultt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>

    <span class="c"># type 2 multiplys</span>

    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011100000001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smuad&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011100000011&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smuadx&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011100000101&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smusd&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011100000111&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smusdx&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011100000001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlad&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011100000011&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smladx&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011100000101&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlsd&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011100000111&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlsdx&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011101000001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlald&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011101000011&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlaldx&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011101000101&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlsld&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011101000111&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smlsldx&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011101010001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smmla&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011101010011&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smmlar&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011101011101&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smmls&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011101011111&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smmlsr&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011101010001&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smmul&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">binary</span><span class="p">(</span><span class="s">&quot;011101010011&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s">&quot;smmulr&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">}</span>

<div class="viewcode-block" id="sh_lsl"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.sh_lsl">[docs]</a><span class="k">def</span> <span class="nf">sh_lsl</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">shval</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">num</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">shval</span></div>
<div class="viewcode-block" id="sh_lsr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.sh_lsr">[docs]</a><span class="k">def</span> <span class="nf">sh_lsr</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">shval</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">num</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">shval</span></div>
<div class="viewcode-block" id="sh_asr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.sh_asr">[docs]</a><span class="k">def</span> <span class="nf">sh_asr</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">shval</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num</span> <span class="o">&gt;&gt;</span> <span class="n">shval</span></div>
<div class="viewcode-block" id="sh_ror"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.sh_ror">[docs]</a><span class="k">def</span> <span class="nf">sh_ror</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">shval</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(((</span><span class="n">num</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">shval</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">num</span><span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="n">shval</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span></div>
<div class="viewcode-block" id="sh_rrx"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.sh_rrx">[docs]</a><span class="k">def</span> <span class="nf">sh_rrx</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">shval</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">half1</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">shval</span>
    <span class="n">half2</span> <span class="o">=</span> <span class="n">num</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="mi">33</span><span class="o">-</span><span class="n">shval</span><span class="p">)</span>
    <span class="n">newC</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">shval</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">emu</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">emu</span><span class="o">.</span><span class="n">getFlags</span><span class="p">()</span>
        <span class="n">oldC</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span><span class="o">&gt;&gt;</span><span class="n">PSR_C</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">emu</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PSR_C_mask</span> <span class="o">|</span> <span class="n">newC</span><span class="p">)</span>     <span class="c">#part of the change</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">oldC</span> <span class="o">=</span> <span class="mi">0</span>        <span class="c"># FIXME: </span>
    <span class="n">retval</span> <span class="o">=</span> <span class="p">(</span><span class="n">half1</span> <span class="o">|</span> <span class="n">half2</span> <span class="o">|</span> <span class="p">(</span><span class="n">oldC</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="n">shval</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span>
    <span class="k">return</span> <span class="n">retval</span>
</div>
<span class="n">shifters</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">sh_lsl</span><span class="p">,</span>
    <span class="n">sh_lsr</span><span class="p">,</span>
    <span class="n">sh_asr</span><span class="p">,</span>
    <span class="n">sh_ror</span><span class="p">,</span>
    <span class="n">sh_rrx</span><span class="p">,</span>
    <span class="p">)</span>


<span class="c">####################################################################</span>
<span class="c"># Mnemonic tables for opcode based mnemonic lookup</span>

<span class="c"># Dataprocessing mnemonics</span>
<span class="n">dp_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;and&quot;</span><span class="p">,</span><span class="s">&quot;eor&quot;</span><span class="p">,</span><span class="s">&quot;sub&quot;</span><span class="p">,</span><span class="s">&quot;rsb&quot;</span><span class="p">,</span><span class="s">&quot;add&quot;</span><span class="p">,</span><span class="s">&quot;adc&quot;</span><span class="p">,</span><span class="s">&quot;sbc&quot;</span><span class="p">,</span><span class="s">&quot;rsc&quot;</span><span class="p">,</span><span class="s">&quot;tst&quot;</span><span class="p">,</span><span class="s">&quot;teq&quot;</span><span class="p">,</span><span class="s">&quot;cmp&quot;</span><span class="p">,</span><span class="s">&quot;cmn&quot;</span><span class="p">,</span><span class="s">&quot;orr&quot;</span><span class="p">,</span><span class="s">&quot;mov&quot;</span><span class="p">,</span><span class="s">&quot;bic&quot;</span><span class="p">,</span><span class="s">&quot;mvn&quot;</span><span class="p">,)</span>

<span class="c"># FIXME: THIS IS FUGLY</span>
<span class="n">dp_noRn</span> <span class="o">=</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
<span class="n">dp_noRd</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>

<span class="c"># FIXME: !!! Don&#39;t make SBZ and SBO&#39;s part of the list of opers !!!</span>
<span class="c">#  first parm SBZ:   mov,mvn</span>
<span class="c">#  second parm SBZ:  tst,teq,cmp,cmn,</span>
<div class="viewcode-block" id="dpbase"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.dpbase">[docs]</a><span class="k">def</span> <span class="nf">dpbase</span><span class="p">(</span><span class="n">opval</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse and return opcode,sflag,Rn,Rd for a standard</span>
<span class="sd">    dataprocessing instruction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ocode</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">21</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">sflag</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="c">#print &quot;DPBASE:&quot;,ocode,sflag,Rn,Rd</span>
    <span class="k">return</span> <span class="n">ocode</span><span class="p">,</span><span class="n">sflag</span><span class="p">,</span><span class="n">Rn</span><span class="p">,</span><span class="n">Rd</span>

<span class="c">####################################################################</span>
<span class="c"># Parser functions for each of the instruction encodings</span>
</div>
<div class="viewcode-block" id="p_dp_imm_shift"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_dp_imm_shift">[docs]</a><span class="k">def</span> <span class="nf">p_dp_imm_shift</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">ocode</span><span class="p">,</span><span class="n">sflag</span><span class="p">,</span><span class="n">Rn</span><span class="p">,</span><span class="n">Rd</span> <span class="o">=</span> <span class="n">dpbase</span><span class="p">(</span><span class="n">opval</span><span class="p">)</span>
    <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">shtype</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span>
    <span class="n">shval</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>     <span class="c">#CHECKME: is this correctly done?</span>

    <span class="k">if</span> <span class="n">ocode</span> <span class="ow">in</span> <span class="n">dp_noRn</span><span class="p">:</span><span class="c"># FIXME: FUGLY (and slow...)</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegShiftImmOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">shval</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">ocode</span> <span class="ow">in</span> <span class="n">dp_noRd</span><span class="p">:</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
            <span class="n">ArmRegShiftImmOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">shval</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
            <span class="n">ArmRegShiftImmOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">shval</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_DP_IMM_SHIFT</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">ocode</span>
    <span class="k">if</span> <span class="n">sflag</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="n">IF_PSR_S</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">dp_mnem</span><span class="p">[</span><span class="n">ocode</span><span class="p">],</span> <span class="n">olist</span><span class="p">,</span> <span class="n">iflags</span><span class="p">)</span>

<span class="c"># specialized mnemonics for p_misc</span></div>
<span class="n">qop_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;qadd&#39;</span><span class="p">,</span><span class="s">&#39;qsub&#39;</span><span class="p">,</span><span class="s">&#39;qdadd&#39;</span><span class="p">,</span><span class="s">&#39;qdsub&#39;</span><span class="p">)</span>
<span class="n">smla_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;smlabb&#39;</span><span class="p">,</span><span class="s">&#39;smlabt&#39;</span><span class="p">,</span><span class="s">&#39;smlatb&#39;</span><span class="p">,</span><span class="s">&#39;smlatt&#39;</span><span class="p">,)</span>
<span class="n">smlal_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;smlalbb&#39;</span><span class="p">,</span><span class="s">&#39;smlalbt&#39;</span><span class="p">,</span><span class="s">&#39;smlaltb&#39;</span><span class="p">,</span><span class="s">&#39;smlaltt&#39;</span><span class="p">,)</span>
<span class="n">smul_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;smulbb&#39;</span><span class="p">,</span><span class="s">&#39;smulbt&#39;</span><span class="p">,</span><span class="s">&#39;smultb&#39;</span><span class="p">,</span><span class="s">&#39;smultt&#39;</span><span class="p">,)</span>
<span class="n">smlaw_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;smlawb&#39;</span><span class="p">,</span><span class="s">&#39;smlawt&#39;</span><span class="p">,)</span>
<span class="n">smlaw_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;smulwb&#39;</span><span class="p">,</span><span class="s">&#39;smulwt&#39;</span><span class="p">,)</span>

<div class="viewcode-block" id="p_misc"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_misc">[docs]</a><span class="k">def</span> <span class="nf">p_misc</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>  
    <span class="c"># 0x0f900000 = 0x01000000 or 0x01000010 (misc and misc1 are both parsed at the same time.  see the footnote [2] on dp instructions in the Atmel AT91SAM7 docs</span>
    <span class="k">if</span>   <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0fc00000</span> <span class="o">==</span> <span class="mh">0x01000000</span><span class="p">:</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&#39;mrs&#39;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">22</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmPgmStatRegOper</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0fc000f0</span> <span class="o">==</span> <span class="mh">0x01200000</span><span class="p">:</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&#39;msr&#39;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">22</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmPgmStatRegOper</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0ff000f0</span> <span class="o">==</span> <span class="mh">0x01200020</span><span class="p">:</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&#39;bxj&#39;</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span> <span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0ff00090</span> <span class="o">==</span> <span class="mh">0x01000080</span><span class="p">:</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">3</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">smla_mnem</span><span class="p">[</span><span class="n">xy</span><span class="p">]</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span> 
        <span class="n">Rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rs</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0ff000b0</span> <span class="o">==</span> <span class="mh">0x01200080</span><span class="p">:</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">6</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">smlaw_mnem</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span> 
        <span class="n">Rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rs</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0ff000b0</span> <span class="o">==</span> <span class="mh">0x012000a0</span><span class="p">:</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">11</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">6</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">smulw_mnem</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rs</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0ff00090</span> <span class="o">==</span> <span class="mh">0x01400080</span><span class="p">:</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">3</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">smlal_mnem</span><span class="p">[</span><span class="n">xy</span><span class="p">]</span>
        <span class="n">Rdhi</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rdlo</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span> 
        <span class="n">Rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rdlo</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rdhi</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rs</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0ff00090</span> <span class="o">==</span> <span class="mh">0x01600080</span><span class="p">:</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">13</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">3</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">smulxy_mnem</span><span class="p">[</span><span class="n">xy</span><span class="p">]</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rs</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&#39;smul&#39;</span>   <span class="c">#xy</span>
    <span class="c">#elif opval &amp; 0x0fc00000 == 0x03200000:</span>
        <span class="c">#mnem = &#39;msr&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_misc: invalid instruction: </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_UNDEF</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&quot;undefined instruction&quot;</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">()</span>
        
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="c">#### these actually belong to the media section, and already exist there. FIXME: DELETE</span>
<span class="c">#misc1_mnem = (&quot;pkhbt&quot;, &quot;pkhtb&quot;, &quot;rev&quot;, &quot;rev16&quot;, &quot;revsh&quot;, &quot;sel&quot;, &quot;ssat&quot;, &quot;ssat16&quot;, &quot;usat&quot;, &quot;usat16&quot;, )</span>
</div>
<div class="viewcode-block" id="p_misc1"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_misc1">[docs]</a><span class="k">def</span> <span class="nf">p_misc1</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span> <span class="c"># </span>
    <span class="c">#R = (opval&gt;&gt;22) &amp; 1</span>
    <span class="c">#Rn = (opval&gt;&gt;16) &amp; 0xf</span>
    <span class="c">#Rd = (opval&gt;&gt;12) &amp; 0xf</span>
    <span class="c">#rot_imm = (opval&gt;&gt;8) &amp; 0xf</span>
    <span class="c">#imm = opval &amp; 0xff</span>
    <span class="c">#Rm = opval &amp; 0xf</span>
    <span class="k">if</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0ff000f0</span> <span class="o">==</span> <span class="mh">0x01200010</span><span class="p">:</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">INS_BX</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&#39;bx&#39;</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span> <span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0ff000f0</span> <span class="o">==</span> <span class="mh">0x01600010</span><span class="p">:</span>  
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&#39;clz&#39;</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0ff000f0</span> <span class="o">==</span> <span class="mh">0x01200030</span><span class="p">:</span>
        <span class="c">#opcode = (IENC_MISC &lt;&lt; 16) + 6</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">INS_BLX</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&#39;blx&#39;</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span> <span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0f9000f0</span> <span class="o">==</span> <span class="mh">0x01000050</span><span class="p">:</span>  <span class="c">#all qadd/qsub&#39;s</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">7</span>
        <span class="n">qop</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">21</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">3</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">qop_mnem</span><span class="p">[</span><span class="n">qop</span><span class="p">]</span>
        <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
        <span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0ff000f0</span> <span class="o">==</span> <span class="mh">0x01200070</span><span class="p">:</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MISC</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&#39;bkpt&#39;</span>
        <span class="n">immed</span> <span class="o">=</span> <span class="p">((</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xfff0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">opval</span><span class="o">&amp;</span><span class="mh">0xf</span><span class="p">)</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ArmImmOper</span><span class="p">(</span><span class="n">immed</span><span class="p">),</span> <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_misc1: invalid instruction: </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>
        
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


</div>
<span class="n">swap_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;swp&quot;</span><span class="p">,</span><span class="s">&quot;swpb&quot;</span><span class="p">,)</span>
<span class="n">strex_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;strex&quot;</span><span class="p">,</span><span class="s">&quot;ldrex&quot;</span><span class="p">,)</span>  <span class="c"># actual full instructions</span>
<span class="c">#strh_mnem = (&quot;strh&quot;,&quot;ldrh&quot;,)</span>
<span class="c">#ldrs_mnem = (&quot;ldrsh&quot;,&quot;ldrsb&quot;,)</span>
<span class="c">#ldrd_mnem = (&quot;ldrd&quot;,&quot;strd&quot;,)</span>
<span class="n">strh_mnem</span> <span class="o">=</span> <span class="p">((</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">IF_H</span><span class="p">),(</span><span class="s">&quot;ldr&quot;</span><span class="p">,</span><span class="n">IF_H</span><span class="p">),)</span>          <span class="c"># IF_H</span>
<span class="n">ldrs_mnem</span> <span class="o">=</span> <span class="p">((</span><span class="s">&quot;ldr&quot;</span><span class="p">,</span><span class="n">IF_S</span><span class="o">|</span><span class="n">IF_H</span><span class="p">),(</span><span class="s">&quot;ldr&quot;</span><span class="p">,</span><span class="n">IF_S</span><span class="o">|</span><span class="n">IF_B</span><span class="p">),)</span>      <span class="c"># IF_SH, IF_SB</span>
<span class="n">ldrd_mnem</span> <span class="o">=</span> <span class="p">((</span><span class="s">&quot;ldr&quot;</span><span class="p">,</span><span class="n">IF_D</span><span class="p">),(</span><span class="s">&quot;str&quot;</span><span class="p">,</span><span class="n">IF_D</span><span class="p">),)</span>        <span class="c"># IF_D</span>
<div class="viewcode-block" id="p_extra_load_store"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_extra_load_store">[docs]</a><span class="k">def</span> <span class="nf">p_extra_load_store</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">pubwl</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">op1</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span>
    <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">iflags</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">opval</span><span class="o">&amp;</span><span class="mh">0x0fb000f0</span><span class="o">==</span><span class="mh">0x01000090</span><span class="p">:</span><span class="c"># swp/swpb</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">pubwl</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_EXTRA_LOAD</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">swap_mnem</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
            <span class="n">ArmImmOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">va</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span><span class="o">&amp;</span><span class="mh">0x0fe000f0</span><span class="o">==</span><span class="mh">0x01800090</span><span class="p">:</span><span class="c"># strex/ldrex</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">pubwl</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_EXTRA_LOAD</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">idx</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">strex_mnem</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span><span class="o">&amp;</span><span class="mh">0x0e4000f0</span><span class="o">==</span><span class="mh">0x000000b0</span><span class="p">:</span><span class="c"># strh/ldrh regoffset</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">pubwl</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_EXTRA_LOAD</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">idx</span>
        <span class="n">mnem</span><span class="p">,</span><span class="n">iflags</span> <span class="o">=</span> <span class="n">strh_mnem</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="n">Rm</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span><span class="o">&amp;</span><span class="mh">0x0e4000f0</span><span class="o">==</span><span class="mh">0x004000b0</span><span class="p">:</span><span class="c"># strh/ldrh immoffset</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">pubwl</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_EXTRA_LOAD</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">idx</span>
        <span class="n">mnem</span><span class="p">,</span><span class="n">iflags</span> <span class="o">=</span> <span class="n">strh_mnem</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmImmOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,(</span><span class="n">Rs</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">Rm</span><span class="p">,</span> <span class="n">va</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span><span class="o">&amp;</span><span class="mh">0x0e4000d0</span><span class="o">==</span><span class="mh">0x004000d0</span><span class="p">:</span><span class="c"># ldrsh/b immoffset</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_EXTRA_LOAD</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">idx</span>
        <span class="n">mnem</span><span class="p">,</span><span class="n">iflags</span> <span class="o">=</span> <span class="n">ldrs_mnem</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmImmOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="p">(</span><span class="n">Rs</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">Rm</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span><span class="o">&amp;</span><span class="mh">0x0e4000d0</span><span class="o">==</span><span class="mh">0x000000d0</span><span class="p">:</span><span class="c"># ldrsh/b regoffset</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_EXTRA_LOAD</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">idx</span>
        <span class="n">mnem</span><span class="p">,</span><span class="n">iflags</span> <span class="o">=</span> <span class="n">ldrs_mnem</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="n">Rm</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span><span class="o">&amp;</span><span class="mh">0x0e5000d0</span><span class="o">==</span><span class="mh">0x000000d0</span><span class="p">:</span><span class="c"># ldrd/strd regoffset</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_EXTRA_LOAD</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="n">idx</span>
        <span class="n">mnem</span><span class="p">,</span><span class="n">iflags</span> <span class="o">=</span> <span class="n">ldrd_mnem</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="n">Rm</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">opval</span><span class="o">&amp;</span><span class="mh">0x0e5000d0</span><span class="o">==</span><span class="mh">0x004000d0</span><span class="p">:</span><span class="c"># ldrd/strd immoffset</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_EXTRA_LOAD</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">14</span> <span class="o">+</span> <span class="n">idx</span>
        <span class="n">mnem</span><span class="p">,</span><span class="n">iflags</span> <span class="o">=</span> <span class="n">ldrd_mnem</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmImmOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="p">(</span><span class="n">Rs</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">Rm</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;extra_load_store: invalid instruction: </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="n">iflags</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="p_dp_reg_shift"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_dp_reg_shift">[docs]</a><span class="k">def</span> <span class="nf">p_dp_reg_shift</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">ocode</span><span class="p">,</span><span class="n">sflag</span><span class="p">,</span><span class="n">Rn</span><span class="p">,</span><span class="n">Rd</span> <span class="o">=</span> <span class="n">dpbase</span><span class="p">(</span><span class="n">opval</span><span class="p">)</span>
    <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">shtype</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span>
    <span class="n">Rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>

    <span class="k">if</span> <span class="n">ocode</span> <span class="ow">in</span> <span class="n">dp_noRn</span><span class="p">:</span><span class="c"># FIXME: FUGLY</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegShiftRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">Rs</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">ocode</span> <span class="ow">in</span> <span class="n">dp_noRd</span><span class="p">:</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
            <span class="n">ArmRegShiftRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">Rs</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
            <span class="n">ArmRegShiftRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">Rs</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_DP_REG_SHIFT</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">ocode</span>
    <span class="k">if</span> <span class="n">sflag</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="n">IF_PSR_S</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">dp_mnem</span><span class="p">[</span><span class="n">ocode</span><span class="p">],</span> <span class="n">olist</span><span class="p">,</span> <span class="n">iflags</span><span class="p">)</span>
</div>
<span class="n">multfail</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,)</span>
<div class="viewcode-block" id="p_mult"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_mult">[docs]</a><span class="k">def</span> <span class="nf">p_mult</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">ocode</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">chopmul</span><span class="p">(</span><span class="n">opval</span><span class="p">)</span>
                             
    <span class="n">mnem</span><span class="p">,</span> <span class="n">opindexes</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">iencmul_codes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ocode</span><span class="p">,</span> <span class="n">multfail</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mnem</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_mult: invalid instruction: </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>

    <span class="n">olist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">opindexes</span><span class="p">:</span>
        <span class="n">olist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ArmRegOper</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MULT</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">ocode</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="p_dp_imm"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_dp_imm">[docs]</a><span class="k">def</span> <span class="nf">p_dp_imm</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">ocode</span><span class="p">,</span><span class="n">sflag</span><span class="p">,</span><span class="n">Rn</span><span class="p">,</span><span class="n">Rd</span> <span class="o">=</span> <span class="n">dpbase</span><span class="p">(</span><span class="n">opval</span><span class="p">)</span>
    <span class="n">imm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
    <span class="n">rot</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1e</span>   <span class="c"># effectively, rot*2</span>
    

    <span class="k">if</span> <span class="n">ocode</span> <span class="ow">in</span> <span class="n">dp_noRn</span><span class="p">:</span><span class="c"># FIXME: FUGLY</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmImmOper</span><span class="p">(</span><span class="n">imm</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">S_ROR</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">ocode</span> <span class="ow">in</span> <span class="n">dp_noRd</span><span class="p">:</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
            <span class="n">ArmImmOper</span><span class="p">(</span><span class="n">imm</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">S_ROR</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
            <span class="n">ArmImmOper</span><span class="p">(</span><span class="n">imm</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">S_ROR</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_DP_IMM</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">ocode</span>
    <span class="k">if</span> <span class="n">sflag</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="n">IF_PSR_S</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">dp_mnem</span><span class="p">[</span><span class="n">ocode</span><span class="p">],</span> <span class="n">olist</span><span class="p">,</span> <span class="n">iflags</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="p_undef"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_undef">[docs]</a><span class="k">def</span> <span class="nf">p_undef</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_undef: invalid instruction (by definition in ARM spec): </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>
    <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_UNDEF</span>
    <span class="n">mnem</span> <span class="o">=</span> <span class="s">&quot;undefined instruction&quot;</span>
    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ArmImmOper</span><span class="p">(</span><span class="n">opval</span><span class="p">),</span>
    <span class="p">)</span>
        
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="p_mov_imm_stat"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_mov_imm_stat">[docs]</a><span class="k">def</span> <span class="nf">p_mov_imm_stat</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>      <span class="c"># only one instruction: &quot;msr&quot;</span>
    <span class="n">imm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
    <span class="n">rot</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">22</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    
    <span class="n">immed</span> <span class="o">=</span> <span class="p">((</span><span class="n">imm</span><span class="o">&gt;&gt;</span><span class="n">rot</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">imm</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="n">rot</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span>
    
    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ArmPgmStatRegOper</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span>
        <span class="n">ArmImmOper</span><span class="p">(</span><span class="n">immed</span><span class="p">),</span>
    <span class="p">)</span>
    
    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_MOV_IMM_STAT</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="s">&quot;msr&quot;</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    </div>
<span class="n">ldr_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;ldr&quot;</span><span class="p">)</span>
<span class="n">tsizes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,)</span>
<div class="viewcode-block" id="p_load_imm_off"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_load_imm_off">[docs]</a><span class="k">def</span> <span class="nf">p_load_imm_off</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">pubwl</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">imm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xfff</span>

    <span class="k">if</span> <span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">:</span>   <span class="c"># B   </span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="n">IF_B</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mh">0x12</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">iflags</span> <span class="o">|=</span> <span class="n">IF_T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
        <span class="n">ArmImmOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="n">imm</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="o">=</span><span class="n">pubwl</span><span class="p">)</span>    <span class="c"># u=-/+, b=word/byte</span>
    <span class="p">)</span>
    
    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_LOAD_IMM_OFF</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">ldr_mnem</span><span class="p">[</span><span class="n">pubwl</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">],</span> <span class="n">olist</span><span class="p">,</span> <span class="n">iflags</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="p_load_reg_off"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_load_reg_off">[docs]</a><span class="k">def</span> <span class="nf">p_load_reg_off</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">pubwl</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
    <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">shtype</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span>
    <span class="n">shval</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>

    <span class="k">if</span> <span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">:</span>   <span class="c"># B   </span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="n">IF_B</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mh">0x12</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">iflags</span> <span class="o">|=</span> <span class="n">IF_T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
        <span class="n">ArmScaledOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="n">Rm</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">shval</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="p">),</span>  <span class="c"># u=-/+, b=word/byte</span>
    <span class="p">)</span>
    
    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_LOAD_REG_OFF</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> 
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">ldr_mnem</span><span class="p">[</span><span class="n">pubwl</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">],</span> <span class="n">olist</span><span class="p">,</span> <span class="n">iflags</span><span class="p">)</span>

    </div>
<div class="viewcode-block" id="p_media"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_media">[docs]</a><span class="k">def</span> <span class="nf">p_media</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    27:20, 7:4</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># media is a parent for the following:</span>
    <span class="c">#  parallel add/sub                         01100</span>
    <span class="c">#  pkh, ssat, ssat16, usat, usat16, sel     01101</span>
    <span class="c">#  rev, rev16, revsh                        01101</span>
    <span class="c">#  smlad, smlsd, smlald, smusd              01110</span>
    <span class="c">#  usad8, usada8                            01111</span>
    <span class="n">definer</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">23</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
    <span class="k">if</span>   <span class="n">definer</span> <span class="o">==</span> <span class="mh">0xc</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p_media_parallel</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">definer</span> <span class="o">==</span> <span class="mh">0xd</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p_media_pack_sat_rev_extend</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">definer</span> <span class="o">==</span> <span class="mh">0xe</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p_mult</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p_media_smul</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p_media_usada</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">)</span>

<span class="c">#generate mnemonics for parallel instructions (could do manually like last time...)</span></div>
<span class="n">parallel_mnem</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">par_suffixes</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;add16&quot;</span><span class="p">,</span> <span class="s">&quot;addsubx&quot;</span><span class="p">,</span> <span class="s">&quot;subaddx&quot;</span><span class="p">,</span> <span class="s">&quot;sub16&quot;</span><span class="p">,</span> <span class="s">&quot;add8&quot;</span><span class="p">,</span> <span class="s">&quot;sub8&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="n">par_prefixes</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;s&quot;</span><span class="p">,</span><span class="s">&quot;q&quot;</span><span class="p">,</span><span class="s">&quot;sh&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="s">&quot;uq&quot;</span><span class="p">,</span><span class="s">&quot;uh&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pre</span> <span class="ow">in</span> <span class="n">par_prefixes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">suf</span> <span class="ow">in</span> <span class="n">par_suffixes</span><span class="p">:</span>
        <span class="n">parallel_mnem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre</span><span class="o">+</span><span class="n">suf</span><span class="p">)</span>

<span class="n">parallel_mnem</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parallel_mnem</span><span class="p">)</span>

<div class="viewcode-block" id="p_media_parallel"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_media_parallel">[docs]</a><span class="k">def</span> <span class="nf">p_media_parallel</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    
    <span class="n">opc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">17</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x38</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">opc1</span> <span class="o">+=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span>
    <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">mnem</span> <span class="o">=</span> <span class="n">parallel_mnem</span><span class="p">[</span><span class="n">opc1</span><span class="p">]</span>
    
    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
        <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
        <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_MEDIA_PARALLEL</span> <span class="o">+</span> <span class="n">opc1</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<span class="n">xtnd_mnem</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">xtnd_suffixes</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;xtab16&quot;</span><span class="p">,</span><span class="s">&quot;xtab&quot;</span><span class="p">,</span><span class="s">&quot;xtah&quot;</span><span class="p">,</span><span class="s">&quot;xtb16&quot;</span><span class="p">,</span><span class="s">&quot;xtb&quot;</span><span class="p">,</span><span class="s">&quot;xth&quot;</span><span class="p">,)</span>
<span class="n">xtnd_prefixes</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">,</span><span class="s">&quot;u&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pre</span> <span class="ow">in</span> <span class="n">xtnd_prefixes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">suf</span> <span class="ow">in</span> <span class="n">xtnd_suffixes</span><span class="p">:</span>
        <span class="n">xtnd_mnem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre</span><span class="o">+</span><span class="n">suf</span><span class="p">)</span>
        
<span class="n">xtnd_mnem</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">xtnd_mnem</span><span class="p">)</span>

<span class="n">pkh_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;pkhbt&#39;</span><span class="p">,</span> <span class="s">&#39;pkhtb&#39;</span><span class="p">,)</span>
<span class="n">sat_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;ssat&#39;</span><span class="p">,</span><span class="s">&#39;usat&#39;</span><span class="p">)</span>
<span class="n">sat16_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;ssat16&#39;</span><span class="p">,</span><span class="s">&#39;usat16&#39;</span><span class="p">)</span>    
<span class="n">rev_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;rev&#39;</span><span class="p">,</span><span class="s">&#39;rev16&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;revsh&#39;</span><span class="p">,)</span>

<div class="viewcode-block" id="p_media_pack_sat_rev_extend"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_media_pack_sat_rev_extend">[docs]</a><span class="k">def</span> <span class="nf">p_media_pack_sat_rev_extend</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="c">## part of p_media</span>
    <span class="c"># assume bit 23 == 1</span>
    <span class="n">opc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span>
    <span class="n">opc2</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">opc25</span> <span class="o">=</span> <span class="n">opc2</span> <span class="o">&amp;</span> <span class="mi">3</span>
    <span class="n">opcode</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">if</span> <span class="n">opc1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">opc25</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   <span class="c">#pkh</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">pkh_mnem</span><span class="p">[(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">6</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">shift_imm</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>

        <span class="c"># &#39;FIXME WHAT WAS OPCODE SUPPOSED TO BE HERE @las?&#39;</span>
        <span class="c"># &#39;dear visi, read the code ;)  move the &quot;mnem =&quot; line if you prefer&#39;</span>
        
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
            <span class="n">ArmRegShiftImmOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">,</span> <span class="n">S_LSL</span><span class="p">,</span> <span class="n">shift_imm</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">opc1</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">opc25</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c">#word sat</span>
        <span class="n">opidx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">22</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span>
        <span class="n">sat_imm</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="k">if</span> <span class="n">opc1</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">:</span> <span class="c"># ?sat16</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="n">sat16_mnem</span><span class="p">[</span><span class="n">opidx</span><span class="p">]</span>
            <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
                <span class="n">ArmImmOper</span><span class="p">(</span><span class="n">sat_imm</span><span class="p">),</span>
                <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_MEDIA_SAT</span> <span class="o">+</span> <span class="n">opidx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="n">sat_mnem</span><span class="p">[</span><span class="n">opidx</span><span class="p">]</span>
            <span class="n">shift_imm</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">2</span>
            <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
                <span class="n">ArmImmOper</span><span class="p">(</span><span class="n">sat_imm</span><span class="p">),</span>
                <span class="n">ArmRegShiftImmOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">shift_imm</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_MEDIA_SAT</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">opidx</span>
            
    <span class="k">elif</span> <span class="p">(</span><span class="n">opc1</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">opc2</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>     <span class="c">#parallel half-word sat</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;WTF! Parallel Half-Word Saturate...  what is that instruction?&quot;</span><span class="p">)</span>
    
    <span class="k">elif</span> <span class="p">(</span><span class="n">opc1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">opc2</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>           <span class="c"># byte rev word</span>
        <span class="n">opidx</span> <span class="o">=</span> <span class="p">((</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">21</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">rev_mnem</span><span class="p">[</span><span class="n">opidx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mnem</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_media_pack_sat_rev_extend: invalid instruction: </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>
 
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_MEDIA_REV</span> <span class="o">+</span> <span class="n">opidx</span>
    <span class="c">#elif opc1 == 3 and opc2 == 0xb:         # byte rev pkt halfword</span>
    <span class="c">#elif opc1 == 7 and opc2 == 0xb:         # byte rev signed halfword</span>
    <span class="k">elif</span> <span class="n">opc1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">opc2</span> <span class="o">==</span> <span class="mh">0xb</span><span class="p">:</span>         <span class="c"># select bytes</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&quot;sel&quot;</span>
        <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_MEDIA_SEL</span>
    <span class="k">elif</span> <span class="n">opc2</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>                         <span class="c"># sign extend</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">xtnd_mnem</span><span class="p">[</span><span class="n">opc1</span><span class="p">]</span>
        <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span>
        <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
        
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
            <span class="n">ArmRegShiftImmOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">,</span> <span class="n">S_ROR</span><span class="p">,</span> <span class="n">rot</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_MEDIA_EXTEND</span> <span class="o">+</span> <span class="n">opc1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_media_extend: invalid instruction: </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c">#smult3_mnem = (&#39;smlad&#39;,&#39;smlsd&#39;,,,&#39;smlald&#39;)</span></div>
<div class="viewcode-block" id="p_media_smul"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_media_smul">[docs]</a><span class="k">def</span> <span class="nf">p_media_smul</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Should not reach here.  If we reach here, we&#39;ll have to implement MEDIA_SMUL extended multiplication (type 3)&quot;</span><span class="p">)</span>
    <span class="c"># hmmm, is this already handled?</span>
    </div>
<div class="viewcode-block" id="p_media_usada"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_media_usada">[docs]</a><span class="k">def</span> <span class="nf">p_media_usada</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    
    <span class="k">if</span> <span class="n">Rn</span> <span class="o">==</span> <span class="mh">0xf</span><span class="p">:</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&quot;usad8&quot;</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rs</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_MEDIA_USAD8</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="s">&quot;usada8&quot;</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rm</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rs</span><span class="p">),</span>
            <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_MEDIA_USADA8</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="p_arch_undef"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_arch_undef">[docs]</a><span class="k">def</span> <span class="nf">p_arch_undef</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_arch_undef: invalid instruction (by definition in ARM spec): </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>
    <span class="c">#print &gt;&gt;sys.stderr,(&quot;implementme: p_arch_undef&quot;)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">IENC_ARCH_UNDEF</span><span class="p">,</span> <span class="s">&#39;arch undefined&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">ArmImmOper</span><span class="p">(</span><span class="n">opval</span><span class="p">),),</span> <span class="mi">0</span><span class="p">)</span>
</div>
<span class="n">ldm_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;stm&quot;</span><span class="p">,</span> <span class="s">&quot;ldm&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="p_load_mult"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_load_mult">[docs]</a><span class="k">def</span> <span class="nf">p_load_mult</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">puswl</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
    <span class="n">mnem</span> <span class="o">=</span> <span class="n">ldm_mnem</span><span class="p">[(</span><span class="n">puswl</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)]</span>
    <span class="c">#flags = ((puswl&lt;&lt;10) &amp; 0x3000) + IF_DA   # ???? WTF?</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="p">((</span><span class="n">puswl</span><span class="o">&amp;</span><span class="mh">0x18</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">21</span><span class="p">)</span> <span class="o">+</span> <span class="n">IF_DA</span>     <span class="c"># store bits for decoding whether to dec/inc before/after between ldr/str.  IF_DA tells the repr to print the the DAIB extension after the conditional</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">reg_list</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xffff</span>
    
    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
        <span class="n">ArmRegListOper</span><span class="p">(</span><span class="n">reg_list</span><span class="p">,</span> <span class="n">puswl</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">puswl</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">:</span>       <span class="c"># W (mnemonic: &quot;!&quot;)</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">IF_W</span>
        <span class="n">olist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">oflags</span> <span class="o">|=</span> <span class="n">OF_W</span>
    <span class="k">if</span> <span class="n">puswl</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">:</span>       <span class="c"># UM - usermode, or mov current SPSR -&gt; CPSR if r15 included</span>
        <span class="n">flags</span> <span class="o">|=</span> <span class="n">IF_UM</span>
        <span class="n">olist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">oflags</span> <span class="o">|=</span> <span class="n">OF_UM</span>

    
    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_LOAD_MULT</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="instrenc"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.instrenc">[docs]</a><span class="k">def</span> <span class="nf">instrenc</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">encoding</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">index</span>
</div>
<span class="n">INS_B</span>       <span class="o">=</span> <span class="n">instrenc</span><span class="p">(</span><span class="n">IENC_BRANCH</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">INS_BL</span>      <span class="o">=</span> <span class="n">instrenc</span><span class="p">(</span><span class="n">IENC_BRANCH</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">INS_BX</span>      <span class="o">=</span> <span class="n">instrenc</span><span class="p">(</span><span class="n">IENC_MISC</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">INS_BXJ</span>     <span class="o">=</span> <span class="n">instrenc</span><span class="p">(</span><span class="n">IENC_MISC</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">INS_BLX</span>     <span class="o">=</span> <span class="n">IENC_UNCOND_BLX</span>

<span class="n">b_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;bl&quot;</span><span class="p">,)</span>
<div class="viewcode-block" id="p_branch"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_branch">[docs]</a><span class="k">def</span> <span class="nf">p_branch</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>        <span class="c"># primary branch encoding.  others were added later in the media section</span>
    <span class="n">off</span> <span class="o">=</span> <span class="n">e_bits</span><span class="o">.</span><span class="n">signed</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">off</span> <span class="o">&lt;&lt;=</span> <span class="mi">2</span>
    <span class="n">link</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>

    <span class="c">#FIXME this assumes A1 branch encoding.</span>
    
    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ArmOffsetOper</span><span class="p">(</span><span class="n">off</span><span class="p">,</span> <span class="n">va</span><span class="p">),)</span>
    <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">envi</span><span class="o">.</span><span class="n">IF_CALL</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">envi</span><span class="o">.</span><span class="n">IF_BRANCH</span>
    
    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_BRANCH</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">link</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">b_mnem</span><span class="p">[</span><span class="n">link</span><span class="p">],</span> <span class="n">olist</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
</div>
<span class="n">ldc_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;stc&quot;</span><span class="p">,</span> <span class="s">&quot;ldc&quot;</span><span class="p">,)</span>
<div class="viewcode-block" id="p_coproc_load"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_coproc_load">[docs]</a><span class="k">def</span> <span class="nf">p_coproc_load</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>       <span class="c">#FIXME: MRRC,  MCRR encoded here.</span>
    <span class="n">punwl</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">CRd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">cp_num</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xff</span>

    <span class="k">if</span> <span class="n">punwl</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">:</span>   <span class="c"># L</span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="n">IF_L</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iflags</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ArmCoprocOper</span><span class="p">(</span><span class="n">cp_num</span><span class="p">),</span>
        <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRd</span><span class="p">),</span>
        <span class="n">ArmImmOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="n">offset</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="o">=</span><span class="n">punwl</span><span class="p">),</span>
    <span class="p">)</span>
    
    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_COPROC_LOAD</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">ldc_mnem</span><span class="p">[</span><span class="n">punwl</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">],</span> <span class="n">olist</span><span class="p">,</span> <span class="n">iflags</span><span class="p">)</span>
</div>
<span class="n">mcrr_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;mcrr&quot;</span><span class="p">,</span> <span class="s">&quot;mrrc&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="p_coproc_dbl_reg_xfer"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_coproc_dbl_reg_xfer">[docs]</a><span class="k">def</span> <span class="nf">p_coproc_dbl_reg_xfer</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">cp_num</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">CRm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">mnem</span> <span class="o">=</span> <span class="n">mcrr_mnem</span><span class="p">[(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">]</span>
    
    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ArmCoprocOper</span><span class="p">(</span><span class="n">cp_num</span><span class="p">),</span>
        <span class="n">ArmCoprocOpcodeOper</span><span class="p">(</span><span class="n">opcode</span><span class="p">),</span>
        <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
        <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
        <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRm</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_COPROC_RREG_XFER</span><span class="o">&lt;&lt;</span><span class="mi">16</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    </div>
<span class="n">cdp_mnem</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;cdp&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">)]</span>
<span class="n">cdp_mnem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;cdp2&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="p_coproc_dp"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_coproc_dp">[docs]</a><span class="k">def</span> <span class="nf">p_coproc_dp</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">opcode1</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">CRn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">CRd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">cp_num</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">opcode2</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span>
    <span class="n">CRm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">mnem</span> <span class="o">=</span> <span class="n">cdp_mnem</span><span class="p">[</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">28</span><span class="p">]</span>

    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ArmCoprocOper</span><span class="p">(</span><span class="n">cp_num</span><span class="p">),</span>
        <span class="n">ArmCoprocOpcodeOper</span><span class="p">(</span><span class="n">opcode1</span><span class="p">),</span>
        <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRd</span><span class="p">),</span>
        <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRn</span><span class="p">),</span>
        <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRm</span><span class="p">),</span>
        <span class="n">ArmCoprocOpcodeOper</span><span class="p">(</span><span class="n">opcode2</span><span class="p">),</span>
    <span class="p">)</span>
    
    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_COPROC_DP</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       <span class="c">#FIXME: CDP2 (cond = 0b1111) also needs handling.</span>
</div>
<span class="n">mcr_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;mcr&quot;</span><span class="p">,</span> <span class="s">&quot;mrc&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="p_coproc_reg_xfer"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_coproc_reg_xfer">[docs]</a><span class="k">def</span> <span class="nf">p_coproc_reg_xfer</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">opcode1</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">21</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span>
    <span class="n">load</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
    <span class="n">CRn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">cp_num</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
    <span class="n">opcode2</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span>
    <span class="n">CRm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>

    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ArmCoprocOper</span><span class="p">(</span><span class="n">cp_num</span><span class="p">),</span>
        <span class="n">ArmCoprocOpcodeOper</span><span class="p">(</span><span class="n">opcode1</span><span class="p">),</span>
        <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
        <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRn</span><span class="p">),</span>
        <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRm</span><span class="p">),</span>
        <span class="n">ArmCoprocOpcodeOper</span><span class="p">(</span><span class="n">opcode2</span><span class="p">),</span>
    <span class="p">)</span>
    
    <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_COPROC_REG_XFER</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mcr_mnem</span><span class="p">[</span><span class="n">load</span><span class="p">],</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="p_swint"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_swint">[docs]</a><span class="k">def</span> <span class="nf">p_swint</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
    <span class="n">swint</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xffffff</span>
    
    <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ArmImmOper</span><span class="p">(</span><span class="n">swint</span><span class="p">),</span> <span class="p">)</span>
    <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_SWINT</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="s">&quot;swi&quot;</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
<span class="n">cps_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;cps&quot;</span><span class="p">,</span><span class="s">&quot;cps FAIL-bad encoding&quot;</span><span class="p">,</span><span class="s">&quot;cpsie&quot;</span><span class="p">,</span><span class="s">&quot;cpsid&quot;</span><span class="p">)</span>
<span class="n">mcrr2_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;mcrr2&quot;</span><span class="p">,</span> <span class="s">&quot;mrrc2&quot;</span><span class="p">)</span>
<span class="n">ldc2_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;stc2&quot;</span><span class="p">,</span> <span class="s">&quot;ldc2&quot;</span><span class="p">,)</span>
<span class="n">mcr2_mnem</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;mcr2&quot;</span><span class="p">,</span> <span class="s">&quot;mrc2&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="p_uncond"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.p_uncond">[docs]</a><span class="k">def</span> <span class="nf">p_uncond</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x0f000000</span> <span class="o">==</span> <span class="mh">0x0f000000</span><span class="p">:</span>
        <span class="c"># FIXME THIS IS HORKED</span>
        <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_SWINT</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">immval</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0x00ffffff</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="s">&#39;swi&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">ArmImmOper</span><span class="p">(</span><span class="n">immval</span><span class="p">),),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">optop</span> <span class="o">=</span> <span class="p">(</span> <span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span>
    <span class="k">if</span> <span class="n">optop</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xfff10020</span> <span class="o">==</span> <span class="mh">0xf1000000</span><span class="p">:</span>
            <span class="c">#cps</span>
            <span class="n">imod</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">18</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">3</span>
            <span class="n">mmod</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">17</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span>
            <span class="n">aif</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">7</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">opval</span><span class="o">&amp;</span><span class="mh">0x1f</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="n">cps_mnem</span><span class="p">[</span><span class="n">imod</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">imod</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">olist</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">ArmCPSFlagsOper</span><span class="p">(</span><span class="n">aif</span><span class="p">)</span>    <span class="c"># if mode is set...</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">olist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">mmod</span><span class="p">:</span>
                <span class="n">olist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ArmImmOper</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
            
            <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_UNCOND_CPS</span> <span class="o">+</span> <span class="n">imod</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xffff00f0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xf1010000</span><span class="p">:</span>
            <span class="c">#setend</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">9</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="s">&quot;setend&quot;</span>
            <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ArmEndianOper</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="p">)</span>
            <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_UNCOND_SETEND</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_uncond (ontop=0): invalid instruction: </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">optop</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf570f000</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xf550f000</span><span class="p">:</span>
            <span class="c">#cache preload  -  also known as a nop on most platforms... does nothing except prefetch instructions from cache.</span>
            <span class="c"># i&#39;m tempted to cut the parsing of it and just return a canned something.</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="s">&quot;pld&quot;</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">25</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>     <span class="c"># what the freak am i supposed to do with &quot;i&quot;???</span>
            <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">U</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">23</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_UNCOND_PLD</span>
            <span class="k">if</span> <span class="n">I</span><span class="p">:</span>
                <span class="n">immoffset</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xfff</span>
                <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span><span class="n">ArmImmOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="n">immoffset</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">U</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">),)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Rm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
                <span class="n">shtype</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span>
                <span class="n">shval</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
                <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span><span class="n">ArmScaledOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="n">Rm</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">shval</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="p">),</span> <span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_uncond (ontop=1): invalid instruction: </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">optop</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xfe5f0f00</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xf84d0500</span><span class="p">:</span>
            <span class="c">#save return state</span>
            <span class="n">pu_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">21</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="s">&quot;srs&quot;</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="p">((</span><span class="n">pu_w</span><span class="o">&lt;&lt;</span><span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3000</span><span class="p">)</span> <span class="o">+</span> <span class="n">IF_DA</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            
            <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ArmModeOper</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">pu_w</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_UNCOND_SRS</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xfe500f00</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xf8100a00</span><span class="p">:</span>
            <span class="c">#rfe</span>
            <span class="n">pu</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">23</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="s">&quot;rfe&quot;</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">pu</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">)</span>  <span class="o">+</span> <span class="n">IF_DA</span>
            <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            
            <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_UNCOND_RFE</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xfe000000</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xfa000000</span><span class="p">:</span>
            <span class="c">#blx</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="s">&quot;blx&quot;</span>
            <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">23</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">2</span>
            <span class="n">imm_offset</span> <span class="o">=</span> <span class="n">e_bits</span><span class="o">.</span><span class="n">signed</span><span class="p">(</span><span class="n">opval</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">h</span>
            
            <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ArmOffsetOper</span><span class="p">(</span><span class="n">imm_offset</span><span class="p">,</span> <span class="n">va</span><span class="p">),</span>
            <span class="p">)</span>
            
            <span class="n">opcode</span> <span class="o">=</span> <span class="n">INS_BLX</span>           <span class="c">#should this be IENC_UNCOND_BLX?</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_uncond (ontop=2): invalid instruction: </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xffe00000</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xfc400000</span><span class="p">:</span>
            <span class="c">#MRCC2/MRRC2</span>
            <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">cp_num</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">CRm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="n">mcrr2_mnem</span><span class="p">[(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">]</span>
                
            <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ArmCoprocOper</span><span class="p">(</span><span class="n">cp_num</span><span class="p">),</span>
                <span class="n">ArmCoprocOpcodeOper</span><span class="p">(</span><span class="n">opcode</span><span class="p">),</span>
                <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
                <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">),</span>
                <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRm</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">opcode</span> <span class="o">=</span> <span class="n">IENC_COPROC_RREG_XFER</span><span class="o">&lt;&lt;</span><span class="mi">16</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xfe000000</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xfc000000</span><span class="p">:</span>
            <span class="c">#stc2/ldc2</span>
            <span class="n">punwl</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span>
            <span class="n">Rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">CRd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">cp_num</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xff</span>

            <span class="k">if</span> <span class="n">punwl</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">:</span>   <span class="c"># L</span>
                <span class="n">iflags</span> <span class="o">=</span> <span class="n">IF_L</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">iflags</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ArmCoprocOper</span><span class="p">(</span><span class="n">cp_num</span><span class="p">),</span>
                <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRd</span><span class="p">),</span>
                <span class="n">ArmImmOffsetOper</span><span class="p">(</span><span class="n">Rn</span><span class="p">,</span> <span class="n">offset</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="o">=</span><span class="n">punwl</span><span class="p">),</span>
            <span class="p">)</span>
            
            <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_COPROC_LOAD</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">ldc2_mnem</span><span class="p">[</span><span class="n">punwl</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">],</span> <span class="n">olist</span><span class="p">,</span> <span class="n">iflags</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xff000010</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xfe000000</span><span class="p">:</span>
            <span class="c">#coproc dp (cdp2)</span>
            <span class="k">return</span> <span class="n">p_coproc_dp</span><span class="p">(</span><span class="n">opval</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xff000010</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xfe000010</span><span class="p">:</span>
            <span class="c">#mcr2/mrc2</span>
            <span class="n">opcode1</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">21</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span>
            <span class="n">load</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="n">CRn</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">Rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">cp_num</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span>
            <span class="n">opcode2</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span>
            <span class="n">CRm</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&amp;</span> <span class="mh">0xf</span>

            <span class="n">olist</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ArmCoprocOper</span><span class="p">(</span><span class="n">cp_num</span><span class="p">),</span>
                <span class="n">ArmCoprocOpcodeOper</span><span class="p">(</span><span class="n">opcode1</span><span class="p">),</span>
                <span class="n">ArmRegOper</span><span class="p">(</span><span class="n">Rd</span><span class="p">),</span>
                <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRn</span><span class="p">),</span>
                <span class="n">ArmCoprocRegOper</span><span class="p">(</span><span class="n">CRm</span><span class="p">),</span>
                <span class="n">ArmCoprocOpcodeOper</span><span class="p">(</span><span class="n">opcode2</span><span class="p">),</span>
            <span class="p">)</span>
            
            <span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">IENC_COPROC_REG_XFER</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">opcode</span><span class="p">,</span> <span class="n">mcr2_mnem</span><span class="p">[</span><span class="n">load</span><span class="p">],</span> <span class="n">olist</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;p_uncond (ontop=3): invalid instruction: </span><span class="si">%.8x</span><span class="s">:</span><span class="se">\t</span><span class="si">%.8x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">opval</span><span class="p">))</span>
    
<span class="c">####################################################################</span>
<span class="c"># Table of the parser functions</span></div>
<span class="n">ienc_parsers_tmp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">21</span><span class="p">)]</span>

<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_DP_IMM_SHIFT</span><span class="p">]</span> <span class="o">=</span>  <span class="n">p_dp_imm_shift</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_MISC</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_misc</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_MISC1</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_misc1</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_EXTRA_LOAD</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_extra_load_store</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_DP_REG_SHIFT</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_dp_reg_shift</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_MULT</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_mult</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_UNDEF</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_undef</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_MOV_IMM_STAT</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_mov_imm_stat</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_DP_IMM</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_dp_imm</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_LOAD_IMM_OFF</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_load_imm_off</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_LOAD_REG_OFF</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_load_reg_off</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_ARCH_UNDEF</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_arch_undef</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_MEDIA</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_media</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_LOAD_MULT</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_load_mult</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_BRANCH</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_branch</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_COPROC_RREG_XFER</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_coproc_dbl_reg_xfer</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_COPROC_LOAD</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_coproc_load</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_COPROC_DP</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_coproc_dp</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_COPROC_REG_XFER</span><span class="p">]</span> <span class="o">=</span>   <span class="n">p_coproc_reg_xfer</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_SWINT</span><span class="p">]</span> <span class="o">=</span>    <span class="n">p_swint</span>
<span class="n">ienc_parsers_tmp</span><span class="p">[</span><span class="n">IENC_UNCOND</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_uncond</span>

<span class="n">ienc_parsers</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ienc_parsers_tmp</span><span class="p">)</span>

<span class="c">####################################################################</span>

<span class="c"># the primary table is index&#39;d by the 3 bits following the</span>
<span class="c"># conditional and are structured as follows:</span>
<span class="c"># ( ENC, nexttable )</span>
<span class="c"># If ENC != None, those 3 bits were enough for us to know the</span>
<span class="c"># encoding type, otherwise move on to the second table.</span>

<span class="c"># The secondary tables have the format:</span>
<span class="c"># (mask, value, ENC).  If the opcode is masked with &quot;mask&quot;</span>
<span class="c"># resulting in &quot;value&quot; we have found the instruction encoding.</span>
<span class="c"># NOTE: All entries in these tables *must* be from most specific</span>
<span class="c"># to least!</span>

<span class="c"># Table for initial 3 bit == 0</span>
<span class="n">s_0_table</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c"># Order is critical here...</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000000000000000000000000010000&quot;</span><span class="p">),</span> <span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000000000000000000000000000000&quot;</span><span class="p">),</span> <span class="n">IENC_DP_IMM_SHIFT</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001100100000000000000010000&quot;</span><span class="p">),</span> <span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001000000000000000000000000&quot;</span><span class="p">),</span> <span class="n">IENC_MISC</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001100100000000000010010000&quot;</span><span class="p">),</span> <span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001000000000000000000010000&quot;</span><span class="p">),</span> <span class="n">IENC_MISC1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001000000000000000011110000&quot;</span><span class="p">),</span> <span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000000000000000000000010010000&quot;</span><span class="p">),</span> <span class="n">IENC_MULT</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001001000000000000010010000&quot;</span><span class="p">),</span> <span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001001000000000000010010000&quot;</span><span class="p">),</span> <span class="n">IENC_EXTRA_LOAD</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000000000000000000000010010000&quot;</span><span class="p">),</span> <span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000000000000000000000010010000&quot;</span><span class="p">),</span> <span class="n">IENC_EXTRA_LOAD</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000000000000000000000010010000&quot;</span><span class="p">),</span> <span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000000000000000000000000010000&quot;</span><span class="p">),</span> <span class="n">IENC_DP_REG_SHIFT</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">IENC_UNDEF</span><span class="p">),</span>   <span class="c">#catch-all</span>
<span class="p">)</span>

<span class="n">s_1_table</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001100110000000000000000000&quot;</span><span class="p">),</span> <span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001000000000000000000000000&quot;</span><span class="p">),</span> <span class="n">IENC_UNDEF</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001100110000000000000000000&quot;</span><span class="p">),</span> <span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001001000000000000000000000&quot;</span><span class="p">),</span> <span class="n">IENC_MOV_IMM_STAT</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">IENC_DP_IMM</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">s_3_table</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001111100000000000011110000&quot;</span><span class="p">),</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001111100000000000011110000&quot;</span><span class="p">),</span> <span class="n">IENC_ARCH_UNDEF</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000000000000000000000000010000&quot;</span><span class="p">),</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000000000000000000000000010000&quot;</span><span class="p">),</span> <span class="n">IENC_MEDIA</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">IENC_LOAD_REG_OFF</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">s_6_table</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00001111111000000000000000000000&quot;</span><span class="p">),</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00001100010000000000000000000000&quot;</span><span class="p">),</span> <span class="n">IENC_COPROC_RREG_XFER</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00001110000000000000000000000000&quot;</span><span class="p">),</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00001100000000000000000000000000&quot;</span><span class="p">),</span> <span class="n">IENC_COPROC_LOAD</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">s_7_table</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001000000000000000000000000&quot;</span><span class="p">),</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001000000000000000000000000&quot;</span><span class="p">),</span> <span class="n">IENC_SWINT</span><span class="p">),</span>
    <span class="p">(</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000001000000000000000000010000&quot;</span><span class="p">),</span><span class="n">binary</span><span class="p">(</span><span class="s">&quot;00000000000000000000000000010000&quot;</span><span class="p">),</span> <span class="n">IENC_COPROC_REG_XFER</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">IENC_COPROC_DP</span><span class="p">),</span>
<span class="p">)</span>

<span class="c"># Initial 3 (non conditional) primary table</span>
<span class="n">inittable</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">s_0_table</span><span class="p">),</span>
    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">s_1_table</span><span class="p">),</span>
    <span class="p">(</span><span class="n">IENC_LOAD_IMM_OFF</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="c"># Load or store an immediate</span>
    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">s_3_table</span><span class="p">),</span>
    <span class="p">(</span><span class="n">IENC_LOAD_MULT</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">IENC_BRANCH</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">s_6_table</span><span class="p">),</span>
    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">s_7_table</span><span class="p">),</span>
    <span class="p">(</span><span class="n">IENC_UNCOND</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
<span class="p">]</span>

<span class="c"># FIXME for emulation...</span>
<span class="c">#def s_lsl(val, shval):</span>
    <span class="c">#pass</span>

<span class="c">#def s_lsr(val, shval):</span>
    <span class="c">#pass</span>

<span class="c"># These are indexed by the 2 bit &quot;shift&quot; value in some DP encodings</span>
<span class="c">#shift_handlers = (</span>
    <span class="c">#s_lsl,</span>
    <span class="c">#s_lsr,</span>
    <span class="c">#s_asr,</span>
    <span class="c">#s_ror,</span>
<span class="c">#)</span>

<span class="n">endian_names</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;le&quot;</span><span class="p">,</span><span class="s">&quot;be&quot;</span><span class="p">)</span>

<span class="c">#FIXME IF_NOFALL (and other envi flags)</span>

<div class="viewcode-block" id="ArmOpcode"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmOpcode">[docs]</a><span class="k">class</span> <span class="nc">ArmOpcode</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Opcode</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mnem</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<div class="viewcode-block" id="ArmOpcode.getBranches"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmOpcode.getBranches">[docs]</a>    <span class="k">def</span> <span class="nf">getBranches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of tuples.  Each tuple contains the target VA of the</span>
<span class="sd">        branch, and a possible set of flags showing what type of branch it is.</span>

<span class="sd">        See the BR_FOO types for all the supported envi branch flags....</span>
<span class="sd">        Example: for bva,bflags in op.getBranches():</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">iflags</span> <span class="o">&amp;</span> <span class="n">envi</span><span class="o">.</span><span class="n">IF_NOFALL</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">va</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">envi</span><span class="o">.</span><span class="n">BR_FALL</span><span class="p">))</span>

        <span class="c"># FIXME if this is a move to PC god help us...</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefixes</span> <span class="o">!=</span> <span class="n">COND_AL</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">envi</span><span class="o">.</span><span class="n">BR_COND</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">INS_B</span><span class="p">:</span>
            <span class="n">oper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">oper</span><span class="o">.</span><span class="n">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">flags</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">INS_BL</span><span class="p">:</span>
            <span class="n">oper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">oper</span><span class="o">.</span><span class="n">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">envi</span><span class="o">.</span><span class="n">BR_PROC</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="ArmOpcode.render"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmOpcode.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcanv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render this opcode to the specified memory canvas</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnem</span> <span class="o">+</span> <span class="n">cond_codes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefixes</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">mnem</span><span class="p">,</span> <span class="n">typename</span><span class="o">=</span><span class="s">&quot;mnemonic&quot;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>

        <span class="c"># Allow each of our operands to render</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opers</span><span class="p">)</span>
        <span class="n">lasti</span> <span class="o">=</span> <span class="n">imax</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">imax</span><span class="p">):</span>
            <span class="n">oper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">oper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">mcanv</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">lasti</span><span class="p">:</span>
                <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
        <span class="c">#mcanv.addText(&#39;; %s&#39; % repr(self))</span>
</div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnem</span> <span class="o">+</span> <span class="n">cond_codes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefixes</span><span class="p">)</span>
        <span class="c"># FIXME put in S flag! -- scratch that... optimize and preload a list of these combos!</span>

        <span class="c"># FIXME actually all these are broke... (iflags)</span>
        <span class="c"># FIXME handle these in parsing too!</span>
        <span class="n">daib_flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iflags</span> <span class="o">&amp;</span> <span class="n">IF_DAIB_MASK</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iflags</span> <span class="o">&amp;</span> <span class="n">IF_L</span><span class="p">:</span>
            <span class="n">mnem</span> <span class="o">+=</span> <span class="s">&#39;l&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">iflags</span> <span class="o">&amp;</span> <span class="n">IF_PSR_S</span><span class="p">:</span>
            <span class="n">mnem</span> <span class="o">+=</span> <span class="s">&#39;s&#39;</span>
        <span class="k">elif</span> <span class="n">daib_flags</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">((</span><span class="n">daib_flags</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">)</span> 
            <span class="n">mnem</span> <span class="o">+=</span> <span class="n">daib</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iflags</span> <span class="o">&amp;</span> <span class="n">IF_S</span><span class="p">:</span>
                <span class="n">mnem</span> <span class="o">+=</span> <span class="s">&#39;s&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iflags</span> <span class="o">&amp;</span> <span class="n">IF_B</span><span class="p">:</span>
                <span class="n">mnem</span> <span class="o">+=</span> <span class="s">&#39;b&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iflags</span> <span class="o">&amp;</span> <span class="n">IF_H</span><span class="p">:</span>
                <span class="n">mnem</span> <span class="o">+=</span> <span class="s">&#39;h&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">iflags</span> <span class="o">&amp;</span> <span class="n">IF_T</span><span class="p">:</span>
                <span class="n">mnem</span> <span class="o">+=</span> <span class="s">&#39;t&#39;</span>
        
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opers</span><span class="p">:</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">mnem</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmRegOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOper">[docs]</a><span class="k">class</span> <span class="nc">ArmRegOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">oflags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">=</span> <span class="n">reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oflags</span> <span class="o">=</span> <span class="n">oflags</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">reg</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oflags</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">oflags</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
    
<div class="viewcode-block" id="ArmRegOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="mi">15</span>
</div>
<div class="viewcode-block" id="ArmRegOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">emu</span><span class="o">.</span><span class="n">getRegister</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmRegOper.setOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOper.setOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">setOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">emu</span><span class="o">.</span><span class="n">setRegister</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmRegOper.render"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOper.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcanv</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">rname</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oflags</span> <span class="o">&amp;</span> <span class="n">OF_W</span><span class="p">:</span>
            <span class="n">rname</span> <span class="o">+=</span> <span class="s">&quot;!&quot;</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">rname</span><span class="p">,</span> <span class="n">typename</span><span class="o">=</span><span class="s">&#39;registers&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ArmRegOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="n">rname</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oflags</span> <span class="o">&amp;</span> <span class="n">OF_W</span><span class="p">:</span>
            <span class="n">rname</span> <span class="o">+=</span> <span class="s">&quot;!&quot;</span>
        <span class="k">return</span> <span class="n">rname</span>
</div></div>
<div class="viewcode-block" id="ArmRegShiftRegOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegShiftRegOper">[docs]</a><span class="k">class</span> <span class="nc">ArmRegShiftRegOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">shreg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">=</span> <span class="n">reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">=</span> <span class="n">shtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shreg</span> <span class="o">=</span> <span class="n">shreg</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">reg</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">shtype</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shreg</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">shreg</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmRegShiftRegOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegShiftRegOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="mi">15</span>
</div>
<div class="viewcode-block" id="ArmRegShiftRegOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegShiftRegOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">shifters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">](</span><span class="n">emu</span><span class="o">.</span><span class="n">getRegister</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">),</span> <span class="n">emu</span><span class="o">.</span><span class="n">getRegister</span><span class="p">(</span><span class="n">shreg</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ArmRegShiftRegOper.render"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegShiftRegOper.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcanv</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">rname</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">rname</span><span class="p">,</span> <span class="n">typename</span><span class="o">=</span><span class="s">&#39;registers&#39;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">shift_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">])</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shreg</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">typename</span><span class="o">=</span><span class="s">&#39;registers&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmRegShiftRegOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegShiftRegOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="n">rname</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;,&quot;</span>
        <span class="k">return</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">rname</span><span class="p">,</span> <span class="n">shift_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">],</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shreg</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
</div></div>
<div class="viewcode-block" id="ArmRegShiftImmOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegShiftImmOper">[docs]</a><span class="k">class</span> <span class="nc">ArmRegShiftImmOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">shimm</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">shimm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shtype</span> <span class="o">==</span> <span class="n">S_ROR</span><span class="p">:</span>
                <span class="n">shtype</span> <span class="o">=</span> <span class="n">S_RRX</span>
            <span class="k">elif</span> <span class="n">shtype</span> <span class="o">==</span> <span class="n">S_LSR</span> <span class="ow">or</span> <span class="n">shtype</span> <span class="o">==</span> <span class="n">S_ASR</span><span class="p">:</span>
                <span class="n">shimm</span> <span class="o">=</span> <span class="mi">32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">=</span> <span class="n">reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">=</span> <span class="n">shtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shimm</span> <span class="o">=</span> <span class="n">shimm</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">reg</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">shtype</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shimm</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">shimm</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmRegShiftImmOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegShiftImmOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="mi">15</span>
</div>
<div class="viewcode-block" id="ArmRegShiftImmOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegShiftImmOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">shifters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">](</span><span class="n">emu</span><span class="o">.</span><span class="n">getRegister</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shimm</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmRegShiftImmOper.render"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegShiftImmOper.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcanv</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">rname</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">rname</span><span class="p">,</span> <span class="n">typename</span><span class="o">=</span><span class="s">&#39;registers&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shimm</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">shift_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">])</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="s">&#39;#</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">shimm</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">==</span> <span class="n">S_RRX</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">shift_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="ArmRegShiftImmOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegShiftImmOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="n">rname</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="p">[</span> <span class="n">rname</span> <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shimm</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="o">+</span><span class="n">shift_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">])</span>
            <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;#</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">shimm</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">==</span> <span class="n">S_RRX</span><span class="p">:</span>
            <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shift_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">])</span>
        <span class="k">return</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">retval</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ArmImmOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmImmOper">[docs]</a><span class="k">class</span> <span class="nc">ArmImmOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">shval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shtype</span><span class="o">=</span><span class="n">S_ROR</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shval</span> <span class="o">=</span> <span class="n">shval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">=</span> <span class="n">shtype</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOperValue</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">getOperValue</span><span class="p">(</span><span class="bp">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmImmOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmImmOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="ArmImmOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmImmOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">shifters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shval</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmImmOper.render"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmImmOper.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcanv</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="s">&#39;#0x</span><span class="si">%.2x</span><span class="s">,</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shval</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="s">&#39;#0x</span><span class="si">%.2x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ArmImmOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmImmOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;#0x</span><span class="si">%.2x</span><span class="s">,</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;#0x</span><span class="si">%.2x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ArmScaledOffsetOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmScaledOffsetOper">[docs]</a><span class="k">class</span> <span class="nc">ArmScaledOffsetOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_reg</span><span class="p">,</span> <span class="n">offset_reg</span><span class="p">,</span> <span class="n">shtype</span><span class="p">,</span> <span class="n">shval</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">shval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shtype</span> <span class="o">==</span> <span class="n">S_ROR</span><span class="p">:</span>
                <span class="n">shtype</span> <span class="o">=</span> <span class="n">S_RRX</span>
            <span class="k">elif</span> <span class="n">shtype</span> <span class="o">==</span> <span class="n">S_LSR</span> <span class="ow">or</span> <span class="n">shtype</span> <span class="o">==</span> <span class="n">S_ASR</span><span class="p">:</span>
                <span class="n">shval</span> <span class="o">=</span> <span class="mi">32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span> <span class="o">=</span> <span class="n">base_reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_reg</span> <span class="o">=</span> <span class="n">offset_reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">=</span> <span class="n">shtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shval</span> <span class="o">=</span> <span class="n">shval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">=</span> <span class="n">pubwl</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">base_reg</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_reg</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">offset_reg</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">shtype</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shval</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">shval</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">pubwl</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmScaledOffsetOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmScaledOffsetOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span> <span class="o">==</span> <span class="mi">15</span>
</div>
<div class="viewcode-block" id="ArmScaledOffsetOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmScaledOffsetOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;FIXME: Implement ArmScaledOffsetOper.getOperValue()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span> <span class="c"># FIXME</span>
</div>
<div class="viewcode-block" id="ArmScaledOffsetOper.render"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmScaledOffsetOper.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcanv</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">pom</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)[(</span><span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">idxing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mh">0x12</span>
        <span class="n">basereg</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">offreg</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">shname</span> <span class="o">=</span> <span class="n">shift_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">]</span>

        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">basereg</span><span class="p">,</span> <span class="n">typename</span><span class="o">=</span><span class="s">&#39;registers&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idxing</span><span class="o">&amp;</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;], &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="n">pom</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">offreg</span><span class="p">,</span> <span class="n">typename</span><span class="o">=</span><span class="s">&#39;registers&#39;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">shname</span><span class="p">)</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="s">&#39;#</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">shval</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idxing</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">idxing</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;]!&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmScaledOffsetOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmScaledOffsetOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="n">pom</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)[(</span><span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">idxing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mh">0x12</span>
        <span class="n">basereg</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">offreg</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">shname</span> <span class="o">=</span> <span class="n">shift_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shtype</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">shval</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> #</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">shname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">shval</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">==</span> <span class="n">S_RRX</span><span class="p">:</span>
            <span class="n">shval</span> <span class="o">=</span> <span class="n">shname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shval</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idxing</span><span class="o">&amp;</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>         <span class="c"># post-indexed</span>
            <span class="n">tname</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">], </span><span class="si">%s%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basereg</span><span class="p">,</span> <span class="n">pom</span><span class="p">,</span> <span class="n">offreg</span><span class="p">,</span> <span class="n">shval</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">idxing</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span>
            <span class="n">tname</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s%s</span><span class="s"> </span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basereg</span><span class="p">,</span> <span class="n">pom</span><span class="p">,</span> <span class="n">offreg</span><span class="p">,</span> <span class="n">shval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>               <span class="c"># pre-indexed</span>
            <span class="n">tname</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s%s</span><span class="s"> </span><span class="si">%s</span><span class="s">]!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basereg</span><span class="p">,</span> <span class="n">pom</span><span class="p">,</span> <span class="n">offreg</span><span class="p">,</span> <span class="n">shval</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tname</span>
</div></div>
<div class="viewcode-block" id="ArmRegOffsetOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOffsetOper">[docs]</a><span class="k">class</span> <span class="nc">ArmRegOffsetOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_reg</span><span class="p">,</span> <span class="n">offset_reg</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span> <span class="o">=</span> <span class="n">base_reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_reg</span> <span class="o">=</span> <span class="n">offset_reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">=</span> <span class="n">pubwl</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">base_reg</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_reg</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">offset_reg</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">pubwl</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmRegOffsetOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOffsetOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span> <span class="o">==</span> <span class="mi">15</span>
</div>
<div class="viewcode-block" id="ArmRegOffsetOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOffsetOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;FIXME: Implement ArmRegOffsetOper.getOperValue()&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmRegOffsetOper.render"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOffsetOper.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcanv</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">pom</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)[(</span><span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">idxing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mh">0x12</span>
        <span class="n">basereg</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">offreg</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">basereg</span><span class="p">,</span> <span class="n">typename</span><span class="o">=</span><span class="s">&#39;registers&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idxing</span><span class="o">&amp;</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;] &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="n">pom</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">offreg</span><span class="p">,</span> <span class="n">typename</span><span class="o">=</span><span class="s">&#39;registers&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idxing</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">idxing</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;]!&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmRegOffsetOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegOffsetOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="n">pom</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)[(</span><span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">idxing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mh">0x12</span>
        <span class="n">basereg</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">offreg</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idxing</span><span class="o">&amp;</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>         <span class="c"># post-indexed</span>
            <span class="n">tname</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">], </span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basereg</span><span class="p">,</span> <span class="n">pom</span><span class="p">,</span> <span class="n">offreg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">idxing</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span>  <span class="c"># offset addressing, not updated</span>
            <span class="n">tname</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basereg</span><span class="p">,</span> <span class="n">pom</span><span class="p">,</span> <span class="n">offreg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>               <span class="c"># pre-indexed</span>
            <span class="n">tname</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s%s</span><span class="s">]!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basereg</span><span class="p">,</span> <span class="n">pom</span><span class="p">,</span> <span class="n">offreg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tname</span>
</div></div>
<div class="viewcode-block" id="ArmImmOffsetOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmImmOffsetOper">[docs]</a><span class="k">class</span> <span class="nc">ArmImmOffsetOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_reg</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">pubwl</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span> <span class="o">=</span> <span class="n">base_reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">=</span> <span class="n">pubwl</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">base_reg</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">offset</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">pubwl</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmImmOffsetOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmImmOffsetOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span> <span class="o">==</span> <span class="mi">15</span>
</div>
<div class="viewcode-block" id="ArmImmOffsetOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmImmOffsetOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">pubwl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">pubwl</span> <span class="o">&gt;&gt;=</span><span class="mi">1</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">pubwl</span> <span class="o">&gt;&gt;=</span><span class="mi">1</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mi">1</span>
        <span class="n">pubwl</span> <span class="o">&gt;&gt;=</span><span class="mi">1</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pubwl</span> 

        <span class="n">addr</span> <span class="o">=</span> <span class="n">emu</span><span class="o">.</span><span class="n">getRegister</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basereg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">:</span>
            <span class="n">addr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">addr</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;L&quot;</span><span class="p">)[</span><span class="n">b</span><span class="p">]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">emu</span><span class="o">.</span><span class="n">readMemoryFormat</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="ArmImmOffsetOper.render"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmImmOffsetOper.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcanv</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">pom</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)[(</span><span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">idxing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span> <span class="o">&amp;</span> <span class="mh">0x12</span>
        <span class="n">basereg</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">basereg</span><span class="p">,</span> <span class="n">typename</span><span class="o">=</span><span class="s">&#39;registers&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">idxing</span><span class="o">&amp;</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;] &#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>

            <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="s">&#39;#</span><span class="si">%s</span><span class="s">0x</span><span class="si">%x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pom</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">idxing</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span>
                <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">idxing</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;]!&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmImmOffsetOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmImmOffsetOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="n">pom</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)[(</span><span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">idxing</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pubwl</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x12</span>
        <span class="n">basereg</span> <span class="o">=</span> <span class="n">arm_regs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_reg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="s">&quot;, #</span><span class="si">%s</span><span class="s">0x</span><span class="si">%x</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">pom</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">idxing</span><span class="o">&amp;</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>         <span class="c"># post-indexed</span>
            <span class="n">tname</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">]</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basereg</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idxing</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">:</span>  <span class="c"># offset addressing, not updated</span>
                <span class="n">tname</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basereg</span><span class="p">,</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>               <span class="c"># pre-indexed</span>
                <span class="n">tname</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s%s</span><span class="s">]!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basereg</span><span class="p">,</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tname</span>
</div></div>
<div class="viewcode-block" id="ArmOffsetOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmOffsetOper">[docs]</a><span class="k">class</span> <span class="nc">ArmOffsetOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>        <span class="c"># ArmImmOper but for Branches</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">va</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="c"># depending on mode, this is reg/imm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">va</span> <span class="o">=</span> <span class="n">va</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">va</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">va</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmOffsetOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmOffsetOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="ArmOffsetOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmOffsetOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">va</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span> <span class="n">op</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">4</span> <span class="c"># FIXME WTF?</span>
</div>
<div class="viewcode-block" id="ArmOffsetOper.render"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmOffsetOper.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcanv</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOperValue</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mcanv</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">isValidPointer</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">addrToName</span><span class="p">(</span><span class="n">mcanv</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addVaText</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addVaText</span><span class="p">(</span><span class="s">&#39;0x</span><span class="si">%.8x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmOffsetOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmOffsetOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="n">targ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOperValue</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="n">tname</span> <span class="o">=</span> <span class="s">&quot;#0x</span><span class="si">%.8x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">targ</span>
        <span class="k">return</span> <span class="n">tname</span>
</div></div>
<span class="n">psrs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;CPSR&quot;</span><span class="p">,</span> <span class="s">&quot;SPSR&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="ArmPgmStatRegOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPgmStatRegOper">[docs]</a><span class="k">class</span> <span class="nc">ArmPgmStatRegOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmPgmStatRegOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPgmStatRegOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="ArmPgmStatRegOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPgmStatRegOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;FIXME: Implement ArmPgmStatRegOper.getOperValue()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span> <span class="c"># FIXME</span>
</div>
<div class="viewcode-block" id="ArmPgmStatRegOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPgmStatRegOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">psrs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">]</span>
    </div></div>
<div class="viewcode-block" id="ArmPgmStatFlagsOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPgmStatFlagsOper">[docs]</a><span class="k">class</span> <span class="nc">ArmPgmStatFlagsOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="c"># FIXED: visi: sorry, i accidentally overrode the previous class to have two meanings</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmPgmStatFlagsOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPgmStatFlagsOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="ArmPgmStatFlagsOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPgmStatFlagsOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;FIXME: Implement ArmPgmStatRegOper.getOperValue()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span> <span class="c"># FIXME</span>
</div>
<div class="viewcode-block" id="ArmPgmStatFlagsOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPgmStatFlagsOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;PSR_&quot;</span><span class="p">,</span><span class="n">psr_fields</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">]]</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    </div></div>
<div class="viewcode-block" id="ArmEndianOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmEndianOper">[docs]</a><span class="k">class</span> <span class="nc">ArmEndianOper</span><span class="p">(</span><span class="n">ArmImmOper</span><span class="p">):</span>
<div class="viewcode-block" id="ArmEndianOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmEndianOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">endian_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="ArmEndianOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmEndianOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="ArmEndianOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmEndianOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span>
</div></div>
<div class="viewcode-block" id="ArmRegListOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegListOper">[docs]</a><span class="k">class</span> <span class="nc">ArmRegListOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">oflags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oflags</span> <span class="o">=</span> <span class="n">oflags</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oflags</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">oflags</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmRegListOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegListOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0x80</span> <span class="o">==</span> <span class="mh">0x80</span>
</div>
<div class="viewcode-block" id="ArmRegListOper.render"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegListOper.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcanv</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;{&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">l</span><span class="p">:</span>
                <span class="n">mcanv</span><span class="o">.</span><span class="n">addNameText</span><span class="p">(</span><span class="n">arm_regs</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">typename</span><span class="o">=</span><span class="s">&#39;registers&#39;</span><span class="p">)</span>
                <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;}&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oflags</span> <span class="o">&amp;</span> <span class="n">OF_UM</span><span class="p">:</span>
            <span class="n">mcanv</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="s">&#39;^&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ArmRegListOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegListOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">reglist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">regidx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
            <span class="c">#FIXME: check processor mode (abort, system, user, etc... use banked registers?)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">regidx</span><span class="p">):</span>
                <span class="n">reg</span> <span class="o">=</span> <span class="n">emu</span><span class="o">.</span><span class="n">getRegister</span><span class="p">(</span><span class="n">regidx</span><span class="p">)</span>
                <span class="n">reglist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reglist</span>
</div>
<div class="viewcode-block" id="ArmRegListOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmRegListOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&quot;{&quot;</span> <span class="p">]</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">l</span><span class="p">)):</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arm_regs</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;}&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oflags</span> <span class="o">&amp;</span> <span class="n">OF_UM</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;^&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    </div></div>
<span class="n">aif_flags</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="s">&#39;if&#39;</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;af&#39;</span><span class="p">,</span><span class="s">&#39;ai&#39;</span><span class="p">,</span><span class="s">&#39;aif&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="ArmPSRFlagsOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPSRFlagsOper">[docs]</a><span class="k">class</span> <span class="nc">ArmPSRFlagsOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmPSRFlagsOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPSRFlagsOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="ArmPSRFlagsOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPSRFlagsOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;FIXME: Implement ArmPSRFlagsOper.getOperValue() (does it want to be a bitmask? or the actual value according to the PSR?)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span> <span class="c"># FIXME</span>
</div>
<div class="viewcode-block" id="ArmPSRFlagsOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmPSRFlagsOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">aif_flags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">]</span>
</div></div>
<div class="viewcode-block" id="ArmCoprocOpcodeOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocOpcodeOper">[docs]</a><span class="k">class</span> <span class="nc">ArmCoprocOpcodeOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
        
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmCoprocOpcodeOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocOpcodeOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="ArmCoprocOpcodeOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocOpcodeOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span>
</div>
<div class="viewcode-block" id="ArmCoprocOpcodeOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocOpcodeOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span>
</div></div>
<div class="viewcode-block" id="ArmCoprocOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocOper">[docs]</a><span class="k">class</span> <span class="nc">ArmCoprocOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
        
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmCoprocOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="ArmCoprocOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span>
</div>
<div class="viewcode-block" id="ArmCoprocOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;p</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span>
</div></div>
<div class="viewcode-block" id="ArmCoprocRegOper"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocRegOper">[docs]</a><span class="k">class</span> <span class="nc">ArmCoprocRegOper</span><span class="p">(</span><span class="n">envi</span><span class="o">.</span><span class="n">Operand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">shtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">shval</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="c"># depending on mode, this is reg/imm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shval</span> <span class="o">=</span> <span class="n">shval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">=</span> <span class="n">shtype</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shval</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">shval</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shtype</span> <span class="o">!=</span> <span class="n">oper</span><span class="o">.</span><span class="n">shtype</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="ArmCoprocRegOper.involvesPC"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocRegOper.involvesPC">[docs]</a>    <span class="k">def</span> <span class="nf">involvesPC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="ArmCoprocRegOper.getOperValue"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocRegOper.getOperValue">[docs]</a>    <span class="k">def</span> <span class="nf">getOperValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">emu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">emu</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;FIXME: Implement ArmCoprocRegOper.getOperValue()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span> <span class="c"># FIXME</span>
</div>
<div class="viewcode-block" id="ArmCoprocRegOper.repr"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmCoprocRegOper.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;c</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span>


</div></div>
<div class="viewcode-block" id="ArmStdDisasm"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmStdDisasm">[docs]</a><span class="k">class</span> <span class="nc">ArmStdDisasm</span><span class="p">:</span>

<div class="viewcode-block" id="ArmStdDisasm.disasm"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmStdDisasm.disasm">[docs]</a>    <span class="k">def</span> <span class="nf">disasm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">trackMode</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a sequence of bytes out into an envi.Opcode instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opbytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">opval</span><span class="p">,</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&quot;&lt;L&quot;</span><span class="p">,</span> <span class="n">opbytes</span><span class="p">)</span>
        
        <span class="n">cond</span> <span class="o">=</span> <span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">28</span>

        <span class="c"># Begin the table lookup sequence with the first 3 non-cond bits</span>
        <span class="n">encfam</span> <span class="o">=</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&gt;&gt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span>
        <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="n">COND_EXTENDED</span><span class="p">:</span>
            <span class="n">enc</span> <span class="o">=</span> <span class="n">IENC_UNCOND</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">enc</span><span class="p">,</span><span class="n">nexttab</span> <span class="o">=</span> <span class="n">inittable</span><span class="p">[</span><span class="n">encfam</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">nexttab</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># we have to sub-parse...</span>
                <span class="k">for</span> <span class="n">mask</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">penc</span> <span class="ow">in</span> <span class="n">nexttab</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">opval</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">==</span> <span class="n">val</span><span class="p">:</span>
                        <span class="n">enc</span> <span class="o">=</span> <span class="n">penc</span>
                        <span class="k">break</span>

        <span class="c"># If we don&#39;t know the encoding by here, we never will ;)</span>
        <span class="k">if</span> <span class="n">enc</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInstruction</span><span class="p">(</span><span class="nb">bytes</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>

        <span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">ienc_parsers</span><span class="p">[</span><span class="n">enc</span><span class="p">](</span><span class="n">opval</span><span class="p">,</span> <span class="n">va</span><span class="p">)</span>
        <span class="c"># Ok...  if we&#39;re a non-conditional branch, *or* we manipulate PC unconditionally,</span>
        <span class="c"># lets call ourself envi.IF_NOFALL</span>
        <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="n">COND_AL</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="p">(</span><span class="n">INS_B</span><span class="p">,</span> <span class="n">INS_BX</span><span class="p">):</span>
                <span class="n">flags</span> <span class="o">|=</span> <span class="n">envi</span><span class="o">.</span><span class="n">IF_NOFALL</span>

            <span class="k">elif</span> <span class="p">(</span>  <span class="nb">len</span><span class="p">(</span><span class="n">olist</span><span class="p">)</span> <span class="ow">and</span> 
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">olist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ArmRegOper</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="n">olist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">involvesPC</span><span class="p">()</span> <span class="p">):</span>
                
                <span class="n">showop</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">flags</span> <span class="o">|=</span> <span class="n">envi</span><span class="o">.</span><span class="n">IF_NOFALL</span>


        <span class="c"># FIXME conditionals are currently plumbed as &quot;prefixes&quot;.  Perhaps normalize to that...</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">ArmOpcode</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
        <span class="n">op</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">enc</span>    <span class="c">#FIXME: DEBUG CODE</span>

        <span class="k">return</span> <span class="n">op</span>
 </div>
<div class="viewcode-block" id="ArmStdDisasm.checkSetMode"><a class="viewcode-back" href="../../../../envi.archs.arm.html#envi.archs.arm.armdisasm.ArmStdDisasm.checkSetMode">[docs]</a>    <span class="k">def</span> <span class="nf">checkSetMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>     <span class="c"># FIXME: i&#39;m forked.  bx references a register...  emulation required unless we want to trust it to always mean a jump to thumb...</span>
        <span class="c"># CHANGE TO THUMB MODE FROM ARM</span>
        <span class="c">#   if bx or blx and target is odd</span>
        <span class="c">#   if dst is r15 and target is odd</span>
        <span class="c">#   if set T bit in SPSR then reload CPSR from SPSR (sh*t, emulation here we come)</span>
        <span class="n">olist</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">opers</span>
        <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">INS_BX</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setMode</span><span class="p">(</span> <span class="n">olist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">1</span> <span class="p">)</span>   <span class="c"># fornicated because we don&#39;t know what the register value is</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setMode</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>            <span class="c"># FIXME: HACK!  assumes always a call to bx </span>
        <span class="k">elif</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">olist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> 
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">olist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ArmRegOper</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">olist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="n">REG_PC</span> <span class="p">):</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">olist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getOperValue</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setMode</span><span class="p">(</span> <span class="n">mode</span><span class="o">&amp;</span><span class="mi">1</span> <span class="p">)</span>

        <span class="c"># CHANGE TO JAZELLE MODE</span>
        <span class="c">#   if bxj is called and jazelle is available and enabled....  sheesh this is gonna get complex</span>
        <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">opcode</span> <span class="o">==</span> <span class="n">INS_BXJ</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">jzl_enabled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setMode</span><span class="p">(</span> <span class="mi">2</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">pass</span> <span class="c"># how do we change PC from here?  bxj changes to jazelle mode, </span>
                     <span class="c"># but if it&#39;s unavailable, the operand is the Arm/Thumb &quot;handler&quot;</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Visi Debugger  documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../../envi.html" >envi</a> &raquo;</li>
          <li><a href="../arm.html" >envi.archs.arm</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, @invisig0th.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>